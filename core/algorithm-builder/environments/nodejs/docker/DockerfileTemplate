# First build
ARG baseVersion
FROM ${pullRegistry}/base-algorithm-nodejs:${baseVersion} AS build
LABEL maintainer="hkube.dev@gmail.com"
ARG packagesRegistry
ARG packagesToken

COPY . /hkube/algorithm-runner
WORKDIR /hkube/algorithm-runner/algorithm_unique_folder

RUN ../docker/requirements.sh ${packagesRegistry} ${packagesToken}

# Second build
FROM ${pullRegistry}/base-algorithm-nodejs:${baseVersion}
COPY --from=build /hkube/algorithm-runner /hkube/algorithm-runner

WORKDIR /hkube/algorithm-runner

CMD ["npm", "start"]
