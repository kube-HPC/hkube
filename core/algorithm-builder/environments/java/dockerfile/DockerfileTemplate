FROM maven
LABEL maintainer="hkube.dev@gmail.com"
ENV PACKAGES_REGISTRY_USER ${PACKAGES_REGISTRY_USER}
ENV PACKAGES_TOKEN ${PACKAGES_TOKEN}
COPY ./algorithm_unique_folder/src/main/resources/settings.xml /root/.m2/settings.xml
COPY ./jars/* /hkube/algorithm-runner/
COPY algorithm_unique_folder/ /hkube/algorithm-runner/algorithm_unique_folder/
COPY ./runJava.sh /hkube/algorithm-runner/
WORKDIR /hkube/algorithm-runner/algorithm_unique_folder/
RUN mvn package -DremoteRepositories=${packagesRegistry}
FROM ${baseImage}
RUN mkdir -p /hkube/algorithm-runner
COPY --from=0 /hkube/algorithm-runner/ /hkube/algorithm-runner
WORKDIR /hkube/algorithm-runner
RUN mkdir -p /hkube-logs
CMD ["/bin/sh", "-c", "./runJava.sh"]
